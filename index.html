<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>Quiz Personaliz√°vel com Recome√ßo Seletivo - Tema Escuro</title>
    <script src="quiz.js"></script>    
    <style>
        /* Estilos Tema Escuro */
        :root {
            /* Cores Escuras */
            --cor-fundo-principal: #121212;
            --cor-fundo-card: #1e1e1e;
            --cor-texto-principal: #f9f9f9;
            --cor-texto-secundario: #bbb;
            --cor-borda: #333;
            --cor-sombra: rgba(0, 0, 0, 0.5);
            
            /* Cores de A√ß√£o/Feedback */
            --cor-primaria: #007bff;
            --cor-primaria-hover: #0056b3;
            --cor-correto: #4CAF50;
            --cor-incorreto: #F44336;
            --cor-recomecar-erros: #ffc107;
            --cor-recomecar-erros-hover: #e0a800;
        }

        body {
            font-family: sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: var(--cor-fundo-principal); 
            color: var(--cor-texto-principal);
        }

        .cabecalho {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .titulo h1 {
            color: var(--cor-texto-principal);
            margin-bottom: 5px;
        }

        .conteudo-jogo {
            width: 90%;
            max-width: 600px;
            padding: 20px;
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            box-shadow: 0 4px 12px var(--cor-sombra); 
            border-radius: 8px;
        }

        /* --- ESTILOS PARA EDI√á√ÉO DE JSON E PROMPT --- */

        #btn-open-editor {
            background: none;
            border: 1px solid var(--cor-borda);
            color: var(--cor-texto-secundario);
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8em;
            margin-bottom: 15px;
            transition: background 0.2s;
            border-radius: 4px;
        }
        #btn-open-editor:hover {
            background: #2b2b2b;
            color: var(--cor-texto-principal);
        }

        #editor-container {
            display: none; 
            width: 90%;
            max-width: 600px;
            padding: 15px;
            background-color: #2b2b2b;
            border: 1px solid var(--cor-borda);
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .prompt-config {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap; 
        }

        .prompt-config label {
            display: flex;
            flex-direction: column;
            font-size: 0.9em;
            color: var(--cor-texto-secundario);
        }
        .prompt-config input, .prompt-config select {
            padding: 5px;
            margin-top: 3px;
            background-color: #121212;
            color: var(--cor-texto-principal);
            border: 1px solid #555;
            border-radius: 4px;
        }

        .prompt-config #input-assunto {
            flex-grow: 1; 
        }
        
        /* Container para alinhar o label e os bot√µes */
        .label-prompt-container {
            display: flex;
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 5px; 
        }
        /* Estilo para garantir que os bot√µes fiquem lado a lado */
        .label-prompt-container > div {
            display: flex;
            gap: 5px; 
        }

        /* Estilos dos Bot√µes de C√≥pia e Colar */
        #btn-copy-prompt-json, #btn-paste-json {
            background: none;
            border: 1px solid var(--cor-borda);
            color: var(--cor-texto-secundario);
            padding: 3px 8px;
            cursor: pointer;
            font-size: 0.75em;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex; 
            align-items: center;
            gap: 5px;
        }

        #btn-copy-prompt-json:hover, #btn-paste-json:hover {
            background: #3a3a3a;
            color: var(--cor-texto-principal);
        }
        
        #json-input {
            width: calc(100% - 10px);
            min-height: 250px; 
            margin-bottom: 10px;
            padding: 5px;
            box-sizing: border-box;
            font-family: monospace;
            font-size: 0.8em;
            background-color: #121212;
            color: var(--cor-texto-secundario);
            border: 1px solid #555;
            resize: vertical;
            border-radius: 4px;
        }

        #btn-apply-json {
            width: 100%;
            height: 40px;
            background: var(--cor-correto);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
            border-radius: 4px;
        }
        #btn-apply-json:hover {
            background: #388e3c;
        }

        /* ------------------- RESTANTE DO QUIZ ------------------------ */

        .questionario {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .conteudo {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .pergunta {
            font-weight: bold;
            font-size: 1.2em;
            color: var(--cor-texto-principal);
        }

        .progresso {
            text-align: right;
            font-size: small;
            margin-bottom: 5px;
            color: var(--cor-texto-secundario);
        }

        .respostas {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .botao-resposta {
            width: 100%;
            min-height: 40px;
            padding: 10px;
            border: 1px solid var(--cor-borda);
            cursor: pointer;
            background: #2b2b2b; 
            color: var(--cor-texto-principal);
            text-align: left;
            transition: background 0.15s, border-color 0.15s;
            border-radius: 4px;
        }

        .botao-resposta:hover:not([disabled]) {
            background: #3a3a3a;
            border-color: #555;
        }
        
        /* Estilos de Feedback */
        .correto {
            background-color: var(--cor-correto) !important;
            color: white;
            border-color: #388e3c !important;
        }

        .incorreto {
            background-color: var(--cor-incorreto) !important;
            color: white;
            border-color: #d32f2f !important;
        }

        /* Justificativa */
        .justificativa-texto {
            font-style: italic;
            font-size: 0.9em;
            color: var(--cor-texto-secundario);
            border-left: 4px solid var(--cor-primaria);
            padding-left: 10px;
            margin-top: 10px;
            display: none; 
        }

        /* Bot√£o de Continua√ß√£o */
        .botao-continuar {
            width: 200px;
            height: 45px;
            margin: 15px 0 0 auto; 
            border: none;
            cursor: pointer;
            background: var(--cor-primaria); 
            color: white;
            font-size: 1em;
            font-weight: 600;
            display: none; 
            transition: background 0.2s;
            border-radius: 4px;
        }

        .botao-continuar:hover {
            background: var(--cor-primaria-hover);
        }
        
        /* Bot√µes de Recome√ßo */
        .botoes-fim {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
            width: 100%;
        }

        .botao-recomecar, .botao-recomecar-erros {
            width: 220px;
            height: 40px;
            border: 1px solid var(--cor-borda);
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s, color 0.2s;
            border-radius: 4px;
        }

        .botao-recomecar {
            background: #3a3a3a;
            color: var(--cor-texto-principal);
        }
        .botao-recomecar:hover {
            background: #555;
        }
        
        .botao-recomecar-erros {
            background: var(--cor-recomecar-erros); 
            color: #1e1e1e; 
            display: none; 
            border-color: var(--cor-recomecar-erros);
        }
        .botao-recomecar-erros:hover {
            background: var(--cor-recomecar-erros-hover);
        }

        .fim {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            text-align: center;
            width: 100%;
        }

        .fim span {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--cor-texto-principal);
        }
    </style>
</head>
<body>

    <header class="cabecalho">
        <div class="titulo">
            <h1>Quiz Essencial</h1>
        </div>
        <button id="btn-open-editor">üõ†Ô∏è Carregar Novo JSON</button>
    </header>


    <div id="editor-container">
        <h3 style="margin-top: 0; color: var(--cor-texto-principal);">Instru√ß√µes para Carregamento</h3>
        <p style="font-size: 0.9em; color: var(--cor-texto-secundario); margin-bottom: 15px;">
            Use o prompt abaixo para pedir a IA Gemini gerar o JSON e ent√£o Voc√™ pode **colar o JSON de quest√µes gerado** diretamente na caixa abaixo. Use os campos de personaliza√ß√£o para **personalizar o prompt**. O resultado da IA deve ser **SOMENTE** o c√≥digo JSON.
        </p>
        <div class="prompt-config">
            <label for="input-quantidade">Quantidade:</label>
            <input type="number" id="input-quantidade" value="10" min="1" max="50" style="width: 50px;">
            
            <label for="select-dificuldade">Dificuldade:</label>
            <select id="select-dificuldade">
                <option value="B√°sico">B√°sico</option>
                <option value="Intermedi√°rio" selected>Intermedi√°rio</option>
                <option value="Avan√ßado">Avan√ßado</option>
                <option value="Certifica√ß√£o">Certifica√ß√£o</option>
            </select>
            
            <label for="input-assunto">Assunto (T√≥pico):</label>
            <input type="text" id="input-assunto" value="Programa√ß√£o Ass√≠ncrona com Async/Await em JavaScript">
        </div>

        <div class="label-prompt-container">
            <label for="json-input" style="font-weight: bold; color: var(--cor-texto-principal);">
                Insira seu JSON ou use este prompt em uma IA:
            </label>
            <div> 
                <button id="btn-copy-prompt-json" title="Copiar prompt gerado para a √°rea de transfer√™ncia">
                    üìã Copiar Prompt
                </button>
                <button id="btn-paste-json" title="Colar JSON do clipboard (navegadores modernos)">
                    üì• Colar JSON
                </button>
            </div>
        </div>
        
        <textarea id="json-input" placeholder="Cole o array JSON com as perguntas aqui ou use o prompt gerado..."></textarea>
        <button id="btn-apply-json">OK - Aplicar e Recome√ßar Quiz</button>
    </div>

    <main class="conteudo-jogo">
        <section class="questionario">
            <div class="conteudo">
                <a href="https://github.com/fabiuniz/quiz_essencial" target="_blank" title="Projeto completo do Quiz Essencial" style="color: #333; text-decoration: none;">  
                  <svg height="20" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="20" data-view-component="true" style="vertical-align: middle; margin-right: 4px;">
                    <path fill="#FFFFFF" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.023 8.023 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                  </svg> GitHub
                </a>
                <span class="progresso"></span>
                <p class="pergunta"></p>
                <div class="respostas"></div>
                <p class="justificativa-texto"></p>
            </div>
            <button class="botao-continuar">Pr√≥xima Pergunta &gt;</button> 
            <div class="fim">
                <span></span>
                <div class="botoes-fim">
                    <button class="botao-recomecar-erros">Recome√ßar (Erros)</button> 
                    <button class="botao-recomecar">Recome√ßar (Completo)</button>
                </div>
            </div>
        </section>
    </main>
    
    <script>
        // Inicializa a vari√°vel no escopo global (window) se ela ainda n√£o existir.
        if (typeof window.perguntasOriginais === 'undefined') {
            window.perguntasOriginais = [...perguntasOriginais] || []; // Assume que quiz.js define perguntasOriginais
        }
        
        // =========================================================================
        // 2. VARI√ÅVEIS DE CONTROLE E ELEMENTOS DOM
        // =========================================================================
        let perguntasAtuais = [...perguntasOriginais]; 
        let perguntasErradas = [];
        let emRepescagem = false;

        const perguntaElemento = document.querySelector(".pergunta");
        const respostasElemento = document.querySelector(".respostas");
        const progressoElemento = document.querySelector(".progresso");
        const textoFinal = document.querySelector(".fim span");
        const conteudo = document.querySelector(".conteudo");
        const conteudoFinal = document.querySelector(".fim");
        const botaoRecomecarCompleto = document.querySelector(".botao-recomecar");
        const justificativaElemento = document.querySelector(".justificativa-texto");
        const botaoContinuar = document.querySelector(".botao-continuar"); 
        const botaoRecomecarErros = document.querySelector(".botao-recomecar-erros"); 
        
        // Elementos para a fun√ß√£o de edi√ß√£o de JSON/Prompt
        const btnOpenEditor = document.getElementById('btn-open-editor');
        const editorContainer = document.getElementById('editor-container');
        const jsonInput = document.getElementById('json-input');
        const btnApplyJson = document.getElementById('btn-apply-json');
        
        // Campos de personaliza√ß√£o
        const inputQuantidade = document.getElementById('input-quantidade');
        const inputAssunto = document.getElementById('input-assunto');
        const selectDificuldade = document.getElementById('select-dificuldade');
        
        // Elementos do Bot√£o de C√≥pia e Colar
        const btnCopyPrompt = document.getElementById('btn-copy-prompt-json');
        const btnPasteJson = document.getElementById('btn-paste-json'); 


        let indiceAtual = 0;
        let acertos = 0;

        // =========================================================================
        // 3. FUN√á√ïES DE FLUXO DO QUIZ
        // =========================================================================

        function selecionarResposta(botaoClicado, respostaCorreta) {
            const perguntaAtual = perguntasAtuais[indiceAtual];
            
            // 1. Desabilita todos os bot√µes e mostra feedback visual
            Array.from(respostasElemento.children).forEach(botao => {
                botao.disabled = true;
                
                // Encontra a resposta no objeto da pergunta
                const respostaAssociada = perguntaAtual.respostas.find(r => r.opcao === botao.textContent);
                
                if (respostaAssociada && respostaAssociada.correto) {
                    botao.classList.add("correto");
                } else if (botao === botaoClicado) {
                    botao.classList.add("incorreto");
                }
            });

            // 2. Conta acertos E armazena erros
            if (respostaCorreta) {
                acertos++;
            } else {
                // Adiciona a pergunta ao array de erros SOMENTE se n√£o estiver l√°
                if (!perguntasErradas.includes(perguntaAtual)) {
                    perguntasErradas.push(perguntaAtual);
                }
            }

            // 3. Exibe a Justificativa e o Bot√£o de Continua√ß√£o
            justificativaElemento.innerHTML = '<strong>Justificativa:</strong> ' + perguntaAtual.justificativa;
            justificativaElemento.style.display = "block"; 
            botaoContinuar.style.display = "block"; 
        }

        function avancarPergunta() {
            justificativaElemento.style.display = "none";
            botaoContinuar.style.display = "none";

            indiceAtual++;

            if (indiceAtual < perguntasAtuais.length) {
                carregarPergunta();
            } else {
                finalizarJogo();
            }
        }

        function carregarPergunta() {
            // Se a lista atual estiver vazia, usa a original para evitar erros
            if (perguntasAtuais.length === 0 && perguntasOriginais.length > 0) {
                 perguntasAtuais = [...perguntasOriginais];
            } else if (perguntasAtuais.length === 0) {
                perguntaElemento.textContent = "Nenhuma quest√£o carregada. Insira o JSON de quest√µes usando o bot√£o 'Carregar Novo JSON'.";
                progressoElemento.textContent = "0/0";
                respostasElemento.innerHTML = "";
                return;
            }

            const perguntaAtual = perguntasAtuais[indiceAtual];
            
            progressoElemento.textContent = `${indiceAtual + 1}/${perguntasAtuais.length}`;
            perguntaElemento.textContent = perguntaAtual.pergunta;

            respostasElemento.innerHTML = ""; 

            // Embaralha as respostas (boa pr√°tica, embora o prompt da IA j√° deva fazer isso)
            const respostasEmbaralhadas = [...perguntaAtual.respostas].sort(() => Math.random() - 0.5);

            respostasEmbaralhadas.forEach(resposta => {
                const botao = document.createElement("button");
                botao.classList.add("botao-resposta");
                botao.textContent = resposta.opcao;
                
                botao.onclick = () => selecionarResposta(botao, resposta.correto);

                respostasElemento.appendChild(botao);
            });
        }

        function finalizarJogo() {
            const totalPerguntasRodada = perguntasAtuais.length; 
            const percentualRodada = ((acertos / totalPerguntasRodada) * 100).toFixed(0); 

            let mensagem;

            if (emRepescagem) {
                mensagem = `Parab√©ns! Na rodada de erros, voc√™ acertou **${acertos} de ${totalPerguntasRodada}** perguntas, atingindo **${percentualRodada}%** de precis√£o.`;
            } else {
                mensagem = `Parab√©ns! Voc√™ acertou **${acertos} de ${totalPerguntasRodada}** perguntas, atingindo **${percentualRodada}%** de acertividade!`;
            }

            textoFinal.innerHTML = mensagem;
            
            conteudo.style.display = "none";
            conteudoFinal.style.display = "flex";

            // Se houver perguntas erradas restantes, mostra o bot√£o de recome√ßo seletivo
            if (perguntasErradas.length > 0) {
                botaoRecomecarErros.textContent = `Recome√ßar (${perguntasErradas.length} Erros)`;
                botaoRecomecarErros.style.display = "block";
            } else {
                botaoRecomecarErros.style.display = "none";
                
                if (emRepescagem) {
                    textoFinal.innerHTML += "<br><br>üéâ **Voc√™ zerou todos os erros! Excelente trabalho!**";
                }
            }
        }

        function recomecarSomenteErros() {
            if (perguntasErradas.length === 0) {
                alert("Voc√™ acertou todas as quest√µes! N√£o h√° erros para refazer.");
                return;
            }

            emRepescagem = true;
            // Cria uma nova lista de perguntas apenas com os erros
            perguntasAtuais = [...perguntasErradas]; 
            // Limpa o rastreador de erros para a pr√≥xima rodada
            perguntasErradas = []; 
            
            indiceAtual = 0;
            acertos = 0; 
            
            conteudoFinal.style.display = "none";
            conteudo.style.display = "flex";
            carregarPergunta();
        }

        function recomecarJogoCompleto() {
            emRepescagem = false;
            
            // Recarrega a lista original de perguntas
            perguntasAtuais = [...perguntasOriginais]; 
            perguntasErradas = []; 
            
            indiceAtual = 0;
            acertos = 0;
            
            conteudoFinal.style.display = "none";
            conteudo.style.display = "flex";
            carregarPergunta();
        }


        // =========================================================================
        // 4. FUN√á√ïES DE EDI√á√ÉO DE JSON E GERA√á√ÉO DE PROMPT
        // =========================================================================

        function toggleEditor() {
            const isHidden = editorContainer.style.display === 'none' || editorContainer.style.display === '';
            editorContainer.style.display = isHidden ? 'block' : 'none';
            if (isHidden) {
                updatePromptText(); // Atualiza o prompt ao abrir
            }
        }

        function applyNewJson() {
            const jsonText = jsonInput.value.trim();
            // Evita que o usu√°rio cole o prompt em vez do JSON.
            if (jsonText.includes("Instru√ß√µes: Crie") && jsonText.includes("Estrutura de Sa√≠da (Formato JSON)")) {
                alert('Aten√ß√£o: Voc√™ colou o **prompt**, e n√£o o JSON. Por favor, use o prompt em uma IA e cole aqui SOMENTE o c√≥digo JSON resultante (o array `[...]`).');
                return;
            }

            if (!jsonText) {
                alert('Por favor, insira o JSON na √°rea de texto.');
                return;
            }

            try {
                const novoJson = JSON.parse(jsonText);

                // Valida√ß√£o b√°sica para garantir que √© um array de perguntas
                if (Array.isArray(novoJson) && novoJson.length > 0 && novoJson[0].hasOwnProperty('pergunta')) {
                    // Define o novo JSON como a fonte original
                    perguntasOriginais = novoJson; 

                    // Reinicia o quiz com a nova lista de perguntas
                    recomecarJogoCompleto(); 

                    alert(`Sucesso! ${novoJson.length} quest√µes carregadas. O quiz foi reiniciado.`);
                    toggleEditor(); // Fecha o editor
                } else {
                    alert('JSON inv√°lido. O JSON deve ser um array de objetos de perguntas com as chaves \"pergunta\", \"justificativa\" e \"respostas\".');
                }

            } catch (e) {
                alert('Erro ao processar JSON: Verifique a sintaxe JSON. Erro: ' + e.message);
            }
        }

        /**
         * Cria um prompt estruturado para gerar quest√µes em formato JSON.
         */
        function criarPromptParaQuestoes(quantidade, assunto, dificuldade) {
            const estruturaExemplo = `
[
    {
        "pergunta": "Qual √© a capital da Fran√ßa?",
        "justificativa": "Paris √© a capital e a maior cidade da Fran√ßa, centro cultural e econ√¥mico.",
        "respostas": [
            {
                "opcao": "Berlim",
                "correto": false
            },
            {
                "opcao": "Paris",
                "correto": true
            },
            {
                "opcao": "Madrid",
                "correto": false
            },
            {
                "opcao": "Roma",
                "correto": false
            }
        ]
    }
]
`;

            const prompt = `
Instru√ß√µes: Crie **${quantidade}** quest√µes de m√∫ltipla escolha sobre o assunto **${assunto}**.

### 1. Estrutura de Sa√≠da (Formato JSON)

O resultado **DEVE** ser um √∫nico array JSON que siga estritamente a estrutura fornecida abaixo, sem qualquer texto adicional ou explica√ß√£o, formata√ß√£o ou introdu√ß√£o antes ou depois do c√≥digo JSON.

* \`pergunta\` (string): O texto da pergunta.
* \`justificativa\` (string): Uma explica√ß√£o clara e detalhada de por que a op√ß√£o correta est√° certa e as outras erradas.
* \`respostas\` (array de objetos): Uma lista de 4 op√ß√µes de resposta.
* Cada objeto dentro de \`respostas\` deve ter os campos:
    * \`opcao\` (string): O texto da op√ß√£o de resposta.
    * \`correto\` (boolean): \`true\` se for a resposta correta, \`false\` caso contr√°rio. Apenas **uma** op√ß√£o deve ser \`true\`.

### 2. Conte√∫do e Dificuldade

* **Assunto:** ${assunto}
* **N√≠vel de Dificuldade:** ${dificuldade}
* **Estilo:** As perguntas devem ser relevantes e cobrir os conceitos centrais do t√≥pico especificado.

### 3. Exemplo da Estrutura (Refer√™ncia)

Use esta estrutura EXATAMENTE, mas com ${quantidade} quest√µes:

\`\`\`json
${estruturaExemplo.trim()}
\`\`\`
`;

            return prompt.trim();
        }

        function updatePromptText() {
            const quantidade = parseInt(inputQuantidade.value) || 10;
            const assunto = inputAssunto.value || "T√≥pico Essencial";
            const dificuldade = selectDificuldade.value || "Intermedi√°rio";
            
            jsonInput.value = criarPromptParaQuestoes(quantidade, assunto, dificuldade);
        }

        // =========================================================================
        // 4.1 FUN√á√ïES DE CONTROLE DO CLIPBOARD
        // =========================================================================
        function copyPromptToClipboard() {
            jsonInput.select();
            jsonInput.setSelectionRange(0, 99999); 

            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'Copiado!' : 'Falha na C√≥pia.';
                
                btnCopyPrompt.textContent = '‚úÖ ' + msg;
                setTimeout(() => {
                    btnCopyPrompt.textContent = 'üìã Copiar Prompt';
                }, 1500); 

            } catch (err) {
                btnCopyPrompt.textContent = '‚ùå Erro ao Copiar';
                console.error('Erro de c√≥pia:', err);
                setTimeout(() => {
                    btnCopyPrompt.textContent = 'üìã Copiar Prompt';
                }, 1500);
                alert('Falha ao tentar copiar o texto. Por favor, copie manualmente.');
            }
        }
        
        async function pasteFromClipboard() {
            if (!navigator.clipboard || !navigator.clipboard.readText) {
                alert('Aten√ß√£o: Seu navegador n√£o suporta a leitura program√°tica do clipboard (API Clipboard). Por favor, use o atalho Ctrl+V ou clique direito > Colar.');
                return;
            }
            
            btnPasteJson.textContent = '... Colando ...';

            try {
                const clipboardText = await navigator.clipboard.readText();
                
                jsonInput.value = clipboardText;

                btnPasteJson.textContent = '‚úÖ Colado!';
                
            } catch (err) {
                console.error('Erro ao ler do clipboard:', err);
                btnPasteJson.textContent = '‚ùå Permiss√£o Negada';
                alert('Falha ao colar: O navegador precisa da sua permiss√£o para ler o clipboard. Por favor, use o atalho Ctrl+V (ou Command+V).');
                
            } finally {
                setTimeout(() => {
                    btnPasteJson.textContent = 'üì• Colar JSON';
                }, 2000);
            }
        }


        // =========================================================================
        // 5. EVENT LISTENERS E INICIALIZA√á√ÉO
        // =========================================================================

        // Eventos do Quiz
        botaoContinuar.onclick = avancarPergunta;
        botaoRecomecarCompleto.onclick = recomecarJogoCompleto;
        botaoRecomecarErros.onclick = recomecarSomenteErros; 

        // Eventos do Editor de JSON
        btnOpenEditor.addEventListener('click', toggleEditor);
        btnApplyJson.addEventListener('click', applyNewJson);
        btnCopyPrompt.addEventListener('click', copyPromptToClipboard); 
        btnPasteJson.addEventListener('click', pasteFromClipboard); 

        // Eventos para atualizar o prompt dinamicamente
        inputQuantidade.addEventListener('input', updatePromptText);
        inputAssunto.addEventListener('input', updatePromptText);
        selectDificuldade.addEventListener('change', updatePromptText);


        // Iniciando o jogo e definindo o prompt inicial na textarea
        updatePromptText();
        carregarPergunta();

    </script>
</body>
</html>